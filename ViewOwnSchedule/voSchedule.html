<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Schedule</title>

    <!-- External CSS Files -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.7/semantic.min.css"
    />
    <!-- Own CSS File -->
    <link href="voSchedule.css" rel="stylesheet" />
  </head>
  <body>
    <div id="app">
      <h1>My WFH Schedule</h1>
  
      <!-- Calendar Container -->
      <div id="calendar"></div>
  
      <!-- Detail Box for Hover Effect -->
      <div id="detailBox"></div>
    </div>

    <!-- External JavaScript Files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.7/semantic.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.js"></script>

    <!-- Initialize FullCalendar -->
    <script src="voSchedule.js"></script>

    <!-- External Libraries and Vue.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/vue@3.2.47/dist/vue.global.js"></script>

    <script>
      
      const { createApp } = Vue

      createApp({
        data() {
          return {
            TeamArr : [],
            ApplicationArr: [],
            ScheduleArr: [],
          };
        },

        mounted(){
          //to get relevant login user to filter Team IDs.
          this.staffID=localStorage.getItem('staffID')
          fetch('http://localhost:5000/employee')
          .then(response => response.json())
          .then(returnedJSON => {
            dataArr = returnedJSON.data;
            staffInd = this.findId(this.staffID,dataArr)
            report = dataArr[staffInd][7]
            this.TeamArr = this.findTeam(report,dataArr)

            fetch('http://localhost:5001/application')
            .then(response => response.json())
            .then(returnedJSON =>{
              this.ApplicationArr = returnedJSON.data; //2D array

              //Name, Role, Status_of_Application, Date, Reason. 
              for (entry of this.ApplicationArr){
                if(entry[3]==='Approved'){
                  for (member of this.TeamArr){
                    if (entry[0]==member[0]){
                      member_name = member[1]
                      member_role = member[2]
                      startDate = entry[1]
                      reason = entry[4]
                      this.ScheduleArr.push({
                        name: member_name,
                        role: member_role,
                        date: startDate,
                        reason: reason
                      })
                    }
                  }
                }
              }
              console.log(this.ScheduleArr) //for the data manipulation for frontend.
              //returns a single array, containing multiple JSONs of approved WFH arrangments to be displayed on schedule.
            })
          })
          .catch(error => console.error('Error fetching data:', error));


        },

        methods: {
          findId(id,arr) {
                    for (let i = 0; i < arr.length; i++) {
                        if (id == arr[i][0]) {
                            return i
                        }
                    }
                    return 0
                },
          //findTeam only finds those within the team (horizontal level)
          //Never those below/above.
          findTeam(id,arr) {
              team_arr=[]
              for (let i = 0; i < arr.length; i++) {
                  if (id == arr[i][7]) {
                    //console.log(arr[i][1])
                      team_arr.push([arr[i][0],arr[i][1]+' '+arr[i][2],arr[i][4]])
                  }
              }

              return team_arr
          },

        }
      }).mount('#app')


    </script>
  </body>
</html>
